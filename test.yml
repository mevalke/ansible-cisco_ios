---
- name: Test looping switch ports
  hosts: all 
  gather_facts: false
  tasks:
  - name: construct list of used ports for sw1
    set_fact:
        sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
    loop: "{{ sw1_interfaces }}"

  - name: construct list of used ports for sw2
    set_fact:
      sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
    loop: "{{ sw2_interfaces }}"

  - name: construct list of used ports for sw3
    set_fact:
      sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
    loop: "{{ sw3_interfaces }}"

  - name: construct list of used ports for sw4
    set_fact:
      sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
    loop: "{{ sw4_interfaces }}"
    
  - name: print used ports on sw1 
    debug:
      msg: "{{ sw1_used_ports }}"

  - name: print used ports on sw2
    debug:
      msg: "{{ sw2_used_ports }}"

  - name: print used ports on sw1 
    debug:
      msg: "{{ sw3_used_ports }}"

  - name: print used ports on sw1 
    debug:
      msg: "{{ sw4_used_ports }}"

  - name: print unused ports on each switch
    debug:
      msg: "{{ item }}"
    loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	
  ---
  - name: Test looping switch ports
      hosts: all 
        gather_facts: false
          tasks:
                    - name: construct list of used ports for sw1
                          set_fact:
                                          sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
                                              loop: "{{ sw1_interfaces }}"

                                                - name: construct list of used ports for sw2
                                                      set_fact:
                                                                    sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
                                                                        loop: "{{ sw2_interfaces }}"

                                                                          - name: construct list of used ports for sw3
                                                                                set_fact:
                                                                                              sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
                                                                                                  loop: "{{ sw3_interfaces }}"

                                                                                                    - name: construct list of used ports for sw4
                                                                                                          set_fact:
                                                                                                                        sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
                                                                                                                            loop: "{{ sw4_interfaces }}"
                                                                                                                                
                                                                                                                              - name: print used ports on sw1 
                                                                                                                                    debug:
                                                                                                                                                  msg: "{{ sw1_used_ports }}"

                                                                                                                                                    - name: print used ports on sw2
                                                                                                                                                          debug:
                                                                                                                                                                        msg: "{{ sw2_used_ports }}"

                                                                                                                                                                          - name: print used ports on sw1 
                                                                                                                                                                                debug:
                                                                                                                                                                                              msg: "{{ sw3_used_ports }}"

                                                                                                                                                                                                - name: print used ports on sw1 
                                                                                                                                                                                                      debug:
                                                                                                                                                                                                                    msg: "{{ sw4_used_ports }}"

                                                                                                                                                                                                                      - name: print unused ports on each switch
                                                                                                                                                                                                                            debug:
                                                                                                                                                                                                                                          msg: "{{ item }}"
                                                                                                                                                                                                                                              loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	
                                                                                                                                                                                                                      ---
                                                                                                                                                                                                                      - name: Test looping switch ports
                                                                                                                                                                                                                          hosts: all 
                                                                                                                                                                                                                            gather_facts: false
                                                                                                                                                                                                                              tasks:
                                                                                                                                                                                                                                        - name: construct list of used ports for sw1
                                                                                                                                                                                                                                              set_fact:
                                                                                                                                                                                                                                                              sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                  loop: "{{ sw1_interfaces }}"

                                                                                                                                                                                                                                                                    - name: construct list of used ports for sw2
                                                                                                                                                                                                                                                                          set_fact:
                                                                                                                                                                                                                                                                                        sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                            loop: "{{ sw2_interfaces }}"

                                                                                                                                                                                                                                                                                              - name: construct list of used ports for sw3
                                                                                                                                                                                                                                                                                                    set_fact:
                                                                                                                                                                                                                                                                                                                  sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                      loop: "{{ sw3_interfaces }}"

                                                                                                                                                                                                                                                                                                                        - name: construct list of used ports for sw4
                                                                                                                                                                                                                                                                                                                              set_fact:
                                                                                                                                                                                                                                                                                                                                            sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                loop: "{{ sw4_interfaces }}"
                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                  - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                        debug:
                                                                                                                                                                                                                                                                                                                                                                      msg: "{{ sw1_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                        - name: print used ports on sw2
                                                                                                                                                                                                                                                                                                                                                                              debug:
                                                                                                                                                                                                                                                                                                                                                                                            msg: "{{ sw2_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                              - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                    debug:
                                                                                                                                                                                                                                                                                                                                                                                                                  msg: "{{ sw3_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                    - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                          debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                        msg: "{{ sw4_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: print unused ports on each switch
                                                                                                                                                                                                                                                                                                                                                                                                                                                debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                              msg: "{{ item }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	
                                                                                                                                                                                                                                                                                                                                                                                                                                          ---
                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: Test looping switch ports
                                                                                                                                                                                                                                                                                                                                                                                                                                              hosts: all 
                                                                                                                                                                                                                                                                                                                                                                                                                                                gather_facts: false
                                                                                                                                                                                                                                                                                                                                                                                                                                                  tasks:
                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: construct list of used ports for sw1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      loop: "{{ sw1_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: construct list of used ports for sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                loop: "{{ sw2_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: construct list of used ports for sw3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          loop: "{{ sw3_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: construct list of used ports for sw4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    loop: "{{ sw4_interfaces }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          msg: "{{ sw1_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: print used ports on sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                msg: "{{ sw2_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      msg: "{{ sw3_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            msg: "{{ sw4_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: print unused ports on each switch
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  msg: "{{ item }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Test looping switch ports
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  hosts: all 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    gather_facts: false
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      tasks:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - name: construct list of used ports for sw1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          loop: "{{ sw1_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: construct list of used ports for sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    loop: "{{ sw2_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: construct list of used ports for sw3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              loop: "{{ sw3_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - name: construct list of used ports for sw4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        loop: "{{ sw4_interfaces }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              msg: "{{ sw1_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - name: print used ports on sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    msg: "{{ sw2_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          msg: "{{ sw3_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                msg: "{{ sw4_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: print unused ports on each switch
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      msg: "{{ item }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: Test looping switch ports
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      hosts: all 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        gather_facts: false
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          tasks:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: construct list of used ports for sw1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              loop: "{{ sw1_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - name: construct list of used ports for sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        loop: "{{ sw2_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: construct list of used ports for sw3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  loop: "{{ sw3_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: construct list of used ports for sw4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            loop: "{{ sw4_interfaces }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  msg: "{{ sw1_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: print used ports on sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msg: "{{ sw2_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              msg: "{{ sw3_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    msg: "{{ sw4_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: print unused ports on each switch
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          msg: "{{ item }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: Test looping switch ports
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          hosts: all 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            gather_facts: false
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              tasks:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: construct list of used ports for sw1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  loop: "{{ sw1_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: construct list of used ports for sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            loop: "{{ sw2_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: construct list of used ports for sw3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      loop: "{{ sw3_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: construct list of used ports for sw4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                loop: "{{ sw4_interfaces }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      msg: "{{ sw1_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: print used ports on sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            msg: "{{ sw2_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  msg: "{{ sw3_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msg: "{{ sw4_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: print unused ports on each switch
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              msg: "{{ item }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ---
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: Test looping switch ports
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              hosts: all 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                gather_facts: false
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  tasks:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: construct list of used ports for sw1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  sw1_used_ports: "{{ sw1_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      loop: "{{ sw1_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: construct list of used ports for sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            sw2_used_ports: "{{ sw2_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                loop: "{{ sw2_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: construct list of used ports for sw3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      sw3_used_ports: "{{ sw3_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          loop: "{{ sw3_interfaces }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: construct list of used ports for sw4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  set_fact:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                sw4_used_ports: "{{ sw4_used_ports + [ item.name ] }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    loop: "{{ sw4_interfaces }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          msg: "{{ sw1_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: print used ports on sw2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                msg: "{{ sw2_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      msg: "{{ sw3_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: print used ports on sw1 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            msg: "{{ sw4_used_ports }}"

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: print unused ports on each switch
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    debug:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  msg: "{{ item }}"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      loop: "{{ vars[ inventory_hostname+'_switch_ports_all' ] | difference(vars[ inventory_hostname+'_used_ports' ]) }}"	

